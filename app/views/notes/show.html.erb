<% content_for :title, sanitize(@note.title) %>

<div class="text-gray-800 dark:text-white">
  <div class="px-4 py-6">
    <div class="flex items-center gap-3 mb-3">
      <%= link_to notes_path, class: "text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200" do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
        </svg>
      <% end %>
      <h1 class="font-bold text-xl"><%= @note.title %></h1>
    </div>
    <%= render 'notes/components/note_meta', note: @note %>
    
    <!-- audio player here -->
    <%= render 'notes/components/audio_player', note: @note %>
    
    <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
      <% if @note.updated_at > @note.created_at + 1.minute %>
        Updated <%= time_ago_in_words(@note.updated_at) %> ago
      <% else %>
        Created <%= time_ago_in_words(@note.created_at) %> ago
      <% end %>
    </div>
  </div>

  <div class="sticky top-0 md:top-14 z-10 bg-white dark:bg-black border-b border-gray-200 dark:border-gray-700">
    <ul class="flex flex-wrap -mb-px text-sm font-medium text-center justify-between md:justify-start px-4">
      <li class="mr-1">
        <%= link_to note_path(@note, tab: 'transcription'), 
            class: "inline-flex items-center justify-center p-2 md:p-4 border-b-2 rounded-t-lg #{@current_tab == 'transcription' ? 'text-green-600 border-green-600 dark:text-green-500 dark:border-green-500' : 'border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300'}" do %>
          <svg class="w-4 h-4 mr-1 md:mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" />
          </svg>
          <span class="">Transcription</span>
        <% end %>
      </li>
      <li class="mr-1">
        <%= link_to note_path(@note, tab: 'summary'), 
            class: "inline-flex items-center justify-center p-2 md:p-4 border-b-2 rounded-t-lg #{@current_tab == 'summary' ? 'text-green-600 border-green-600 dark:text-green-500 dark:border-green-500' : 'border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300'}" do %>
          <svg class="w-4 h-4 mr-1 md:mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z" />
          </svg>
          <span class="">Summary</span>
        <% end %>
      </li>
      <li>
        <%= link_to note_path(@note, tab: 'chat'), 
            class: "inline-flex items-center justify-center p-2 md:p-4 border-b-2 rounded-t-lg #{@current_tab == 'chat' ? 'text-green-600 border-green-600 dark:text-green-500 dark:border-green-500' : 'border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300'}" do %>
          <svg class="w-4 h-4 mr-1 md:mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z" />
          </svg>
          <span class="">Chat</span>
        <% end %>
      </li>
    </ul>
  </div>

  <div class="tab-content">
    <% case @current_tab %>
    <% when 'transcription' %>
      <div class="p-4 text-justify">
        <% if @note.transcription.present? %>
          <div class="prose prose-sm dark:prose-invert max-w-none trix-content
            prose-headings:font-bold prose-headings:text-gray-900 dark:prose-headings:text-white 
            prose-p:my-2 prose-ul:my-2 prose-li:my-1 
            prose-blockquote:border-l-4 prose-blockquote:border-gray-300 dark:prose-blockquote:border-gray-600 prose-blockquote:pl-4 prose-blockquote:italic
            prose-a:text-green-600 dark:prose-a:text-green-400
            prose-strong:text-gray-800 dark:prose-strong:text-gray-200" data-controller="bible-verse-link">
            <%= sanitize(process_bible_verses(format_transcription_with_breaks(@note.transcription))) %>
          </div>
        <% else %>
          <div class="text-center text-gray-500 dark:text-gray-400 py-8">
            <p>No transcription available yet.</p>
          </div>
        <% end %>
      </div>
      <!--<div class="text-xs text-gray-500 dark:text-gray-400 mt-2 mb-8">
        <span class="inline-flex items-center px-2 py-1 rounded-full bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-400">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
          Transcribed with Gemini 2.5 Pro
        </span>
      </div>-->
    <% when 'summary' %>
      <% if @note.summary.present? %>
        <div class="p-4 text-justify">
          <div class="prose prose-sm dark:prose-invert max-w-none trix-content
            prose-headings:font-bold prose-headings:text-gray-900 dark:prose-headings:text-white 
            prose-p:my-2 prose-ul:my-2 prose-li:my-1 
            prose-blockquote:border-l-4 prose-blockquote:border-gray-300 dark:prose-blockquote:border-gray-600 prose-blockquote:pl-4 prose-blockquote:italic
            prose-a:text-green-600 dark:prose-a:text-green-400
            prose-strong:text-gray-800 dark:prose-strong:text-gray-200" data-controller="bible-verse-link">
            <%= sanitize(process_bible_verses(@note.summary)) %>
          </div>
        </div>
      <% else %>
        <div class="text-center py-10">
          <p class="text-gray-500 dark:text-gray-400">No summary available yet.</p>
        </div>
      <% end %>
    <% when 'chat' %>
      <%= render 'notes/components/note_chat', note: @note %>
    <% end %>
  </div>
</div>
